(function(a){if(typeof define==="function"&&define.amd){define(function(){return a.waitFor()})}else{window.WaitFor=a.waitFor}}({waitFor:function(){var c=false;function e(g){c&&window.console&&console.log(g)}function d(h,k,i){var g;try{g=new (this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");g.open(i?"POST":"GET",h,1);g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.setRequestHeader("Content-type","application/x-www-form-urlencoded");g.onreadystatechange=function(){g.readyState>3&&k&&k(g.responseText,g)};g.send(i)}catch(j){e(j);if(k){k(null,g)}}}function a(h){var g={};if(g.toString.call(h)==="[object Function]"){return"function"}else{if(h instanceof RegExp){return"regexp"}else{return"string"}}}function b(g){d(g.url,function(i,j){if(i&&g.check){var h=false;if(g.checkType==="function"){h=g.check(i)}else{if(g.checkType==="regexp"){h=g.check.test(i)}else{h=g.check===i}}if(h){e("onfinish with "+i);if(g.onfinish){g.onfinish(g,i)}return}else{e("check failed")}}setTimeout(function(){f(g)},g.timeout)})}function f(g){e("handling timeout..."+g.timeout);if(g.timeout<g.finalTimeout){g.timeout=g.timeout*g.timeoutStep}else{g.timeout=g.initialTimeout}g.timeElapsed+=g.timeout;if(g.maxTimeout&&g.timeElapsed>=g.maxTimeout){e("max timeout reached, giving up");if(g.ongiveup){g.ongiveup()}}else{b(g)}}return{poll:function(h){h=h||{};var g={initialTimeout:1000,finalTimeout:4000,maxTimeout:0,timeoutStep:2,timeElapsed:0};for(var i in g){if(!h.hasOwnProperty(i)){h[i]=g[i]}}if(!h.url){if(h.path){h.url=window.location.protocol+"//"+window.location.hostname;if(window.location.port){h.url+=":"+window.location.port}h.url+=h.path}else{h.url=window.location.href}}h.timeout=h.initialTimeout;h.checkType=a(h.check);e("registering "+h.url);setTimeout(function(){f(h)},h.timeout)}}}}));